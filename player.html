<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dextube Player</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body { 
            background-color: #121212; 
            color: #f1f1f1; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            flex-direction: column; 
            font-family: 'Roboto', sans-serif;
        }
        #main-video { 
            max-width: 900px; 
            width: 90%; 
            height: auto; 
            border-radius: 8px; 
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        #cid-display { 
            margin-top: 15px; 
            font-size: 14px; 
            color: #4CAF50; 
            word-break: break-all;
        }
    </style>
</head>
<body>
    
    <video id="main-video" controls autoplay></video>
    
    <p id="cid-display">Loading decentralized video...</p>

    <script>
        // Use the public gateway for viewing
        const IPFS_GATEWAY = 'https://ipfs.io/ipfs/'; 

        function playVideo() {
            // Get the video CID from the URL parameter (e.g., ?cid=Qm...)
            const urlParams = new URLSearchParams(window.location.search);
            const videoCid = urlParams.get('cid');

            const videoElement = document.getElementById('main-video'); 
            const cidDisplay = document.getElementById('cid-display');

            if (videoCid) {
                const streamUrl = IPFS_GATEWAY + videoCid;
                
                // CRITICAL FIX: Adding the <source> element with type="video/mp4" 
                // explicitly tells the browser what format to expect, which is essential 
                // for starting the stream (HTTP Range Requests).
                videoElement.innerHTML = `
                    <source src="${streamUrl}" type="video/mp4">
                    Your browser does not support the video tag or the stream is unavailable.
                `;
                
                cidDisplay.textContent = 'Streaming Content Hash (CID): ' + videoCid;
                
                // Attempt to load and play the video
                videoElement.load();
                videoElement.play().catch(e => {
                    // This often catches browser policies blocking immediate autoplay
                    console.warn("Autoplay was prevented by browser policy:", e.name);
                    // Update display to prompt user to interact
                    cidDisplay.textContent += " (Note: Autoplay blocked. Please click the play button.)";
                });
            } else {
                cidDisplay.textContent = 'Error: Video CID not found in URL.';
            }
        }
        
        document.addEventListener('DOMContentLoaded', playVideo);
    </script>
</body>
</html>